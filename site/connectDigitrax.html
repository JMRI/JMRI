<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<!-- $Id: connectDigitrax.html,v 1.9 2003-07-24 21:26:28 jacobsen Exp $ -->
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Bob Jacobsen, LBL">
   <meta name="GENERATOR" content="Mozilla/4.75C-CCK-MCD {C-UDP; EBM-APPLE} (Macintosh; U; PPC) [Netscape]">
   <meta name="Content-Type" content="text/html; charset=iso-8859-1">
   <title>Connecting to a Digitrax DCC system</title>
</head>
<body>

<IMG SRC="images/logo.gif" ALIGN=RIGHT WIDTH="160" HEIGHT="135" HSPACE="0" VSPACE="0">

DecoderPro works with your DIgitrax command station to program decoders.
To do this, it communicates with the command station over the LocoNet
using an MS100 or LocoBuffer adapter.
<P>
Note that DecoderPro cannot directly program decoders via a PR1 programmer.
You have to use a command station.

<h2>Connecting to a Digitrax DCC system</h2>
To connect your computer to a Digitrax DCC system, you need a
either a MS100 or LocoBuffer adapter.  See below for more information
on these.  The LocoBuffer is recommended.  Connect your MS100 or LocoBuffer
to the LocoNet, and connect your computer to it with the appropriate serial cable.
<P>
Then go to the preferences panel of a JMRI-based program.  This opens 
automatically the first time a program is run, or you can select it from
the "Edit" menu.  
<P>
Select "Digitrax MS100" or "Digitrax LocoBuffer" from the top selection box. You can then
select the proper serial port in the second selection box.  
<P>
The baud rate box will be fixed if you've selected an MS100.  There
are two choices for the LocoBuffer; select the one the corresponds to the
jumper settings on the LocoBuffer board. We recommend that you start with
the 19,200 choice for the LocoBuffer, see
<A HREF="#locobuffer">below</a> for more information.
<P>
The fourth box should be left on
"hardware flow control" unless you later consistently get a message
about the LocoBuffer control leads being improperly set up, in which case
you might want to try to bypass that by selecting "no flow control".
This box will be blank if you've selected MS100.
<P>
In the fifth box, select the type of command station you have.  Note that
this program can't read decoder CVs if you have an Empire Builder (DB150);
that's due to the Empire Builder hardware, and there's nothing we can do about it.
<P>
The series of radio buttons labelled "GUI style" allows you to select
how the program will look.  
"Metal" is the native Java look available on all types. 
Other choices will vary with your computer type. "Motif", "Windows", "MacOS" 
and "MacOS Adaptive" look native on Linux, Windows, MacOS "Classic" and MacOS X
respectively.
<P>
In the bottom selection box, you can pick the default programmer format. You can
override this each time you open the programmer, so this is here just for convenience.
<P>
Click "Save".  You'll be asked if it's OK for the program to quit, click "Yes".
<P>
Restart the program. You should be up and running.

<h2>Information on the LocoBuffer and MS100 adapters</h2>
There are two hardware adapters available to connect to a LocoNet.  The
LocoBuffer is the strongly preferred alternative, as it reduces the load 
on the host computer and has a significantly smaller error rate.  The
Digitrax MS100 interface adapter is also supported (except on MacOS X). 

<P>
Note that these are LocoNet interfaces, not standalone programmers like
the Digitrax PR1.  Neither of them will let you read CVs if you
have an Empire Builder!  For that you need a Chief or Zephyr command
station.  (We're working on PR1 support, and would welcome help).

<A ID="locobuffer"><h3>LocoBuffer</h3><a/>

<A ID="locobuffer">The LocoBuffer was created by John Jabour </a>
(<a href="mailto:jjabour@optonline.net">jjabour@optonline.net</a>).
More information is also available from his web page, 
<a href="http://www.locobuffer.com/LocoBuffer.htm">http://www.locobuffer.com/LocoBuffer.htm</a>.
John sells assembled units, 
<a href="http://www.locobuffer.com/Kits.htm">kits that include all parts</A>, 
or just the bare PC 
board.  Or you can build one yourself from scratch.
<P>
The LocoBuffer should be configured with J1, J4 and J5 set on pins 1 and 2, 
J2 and J3 set to pins 2 and 3. This configures it for a 19,200 baud
connection, so select "19,200 baud" when configuring the connection.
<P>
For the most reliable operation, turn on your layout and computer before
you turn on the LocoBuffer.
<P>
Some computers can successfully communicate at 57,600bps with a LocoBuffer.
To do this, select "57,600 baud" when configuring
and configure your LocoBuffer with J4 and J5 set on pins 1 and 2, 
J1, J2 and J3 set to pins 2 and 3 (J1 is the one that determines the baud rate).
But we strongly recommend that you try 19,200 and make sure that works first.

<P>The LocoBuffer controller chip should
contain version 1.4.6 or later of the LocoBuffer program. Note that
LocoBuffer version 1.4.5 has a bug that prevents it from working with this program.
If you got your LocoBuffer chip after February 2002, this should not be a 
problem for you.

<H3><A id="rs232leads">LocoBuffer flow control</a></h3>
Some Windows versions, in particular Win2000, cannot handle the 
LocoBuffer's control leads properly.  You'll see this as 
DecoderPro or JmriDemo being unable to communicate with the command station, even though
you can see LocoNet traffic with the LocoNet monitor.  To fix this, 
try opening the preferences and select "no flow control" option,
click save, then quit and restart the program.  Note that this
problem is specific to certain Windows versions, and you generally should
have "hardware flow control" selected.  
<P>
If the problem persists, please try jumpering-together the pins 5, 6 and 8 on the 
LocoBuffer's 25-pin connector.
These are the CTS, DSR, and DCD 
leads in the LocoBuffers RS232 interface, and connecting them will (perhaps)
fool your computer into accepting the LocoBuffers flow control signals.
<p>
That connector has a row of 12 pins and a row of 13.  Looking at the solder-side of the 
board, pin 1 is at the end of the row of 13 (toward the center of the board), at the end 
nearest the RJ12 LocoNet jack.  Next to that are pins 2, 3, 4 and 5 with traces on them.    
Pin 6 is next to that, with nothing connected.  Pin 7 (ground) has a trace, then pin 8 does not.
<P>
So the suggestion is to connect pin 5 (with a trace) to pin 6 and 8 (without traces).  Be careful 
not to short to pin 7, which is already connected.



<h3><A id="oldermac">Serial ports on older Macintoshes and the MS100</a></h3>
A standard Macintosh RS422 serial port will not work directly 
with an MS100. Since it doesn't have two output status lines (DTR and RTS),
it can't provide correct power to the MS100.  It may be possible to 
provide external power; if you're interested in trying this, we'd
be happy to help work out a solution. A LocoBuffer will work fine
with a standard Macintosh RS422 serial port.

<H3><a id="ms100check">Checking to see if the MS100 will work with your computer</a></h3>
In MS100 mode, the program attempts to open the port at 16600 baud, 
the LocoNet rate.  If this fails, it attempts to open the port at 16457 baud, 
which is a standard rate that's close enough to work.  If this also
fails, the program pops a dialog box to tell you that it can't
set the port to a usable baud rate.  This will always happen on MacOS X, which
is why the MS100 can't be used with MacOS X.  It has also happened
on some computers with Intel-based hardware.  
Because we can't be sure your computer will be able to talk to a 
MS100 without trying it, you should test this before spending money
on the MS100. To do that:
<UL>
<LI>Start the program.
<LI>Set the preferences for MS100 and your serial port. You
don't need to have anything connected, but do select the port
you will eventually be using. 
<LI>Save the preferences.
<LI>Quit the program and restart it so that the preferences take effect.
</UL>If you get a dialog box saying "Could not set baud rate...", then 
you won't be able to use your computer with a MS100.  You should use 
a LocoBuffer.

<h3><a id="usb">USB connections</a></h3> 
DecoderPro is tested with both a MS100 and a LocoBuffer on 
a USB Macintosh using a Keyspan PDA 
Adapter to provide the serial port; for information please see 
<a href="http://jmri.sourceforge.net/DigiTrax/KeyspanAdapters/KeyspanUSB.html">http://jmri.sourceforge.net/DigiTrax/KeyspanAdapters/KeyspanUSB.html</a>. 
Note that we've had a report that certain models of the PDA adapter don't work at 57,600 baud with
the LocoBuffer,  so please try 19,200 baud if you're having trouble. See 
<A href="#locobuffer">above</a> for instructions on how to set the LocoBuffer's speed.
<P>
For more information on the MS100, please see
<a href="http://www.digitrax.com/computer.htm">http://www.digitrax.com/computer.htm</a>

<HR>
<BR>Site hosted by: <BR>
<A href="http://sourceforge.net"> 
<IMG src="http://sourceforge.net/sflogo.php?group_id=26788&type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A>
 
<hr>
Bob Jacobsen<BR>
jake@physics.berkeley.edu

</body>
</html>
