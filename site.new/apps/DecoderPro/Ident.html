<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: Ident.html,v 1.2 2006-02-26 20:45:54 jacobsen Exp $ -->
<html lang="en">
<head>
    <TITLE>
	JMRI: DecoderPro User Guide - How DecoderPro Identifies Decoders
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <META content="John Plocher" name=Author>
    <meta name="keywords" content="java model railroad JMRI identification ident decoder user guide">

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->

</head>

<body>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Define logo images/decoderpro.gif -->
<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/decoderpro.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->


<hr class="hide">

    <div id="mBody">

    <!-- Or, you can delete the entire div id=side block if you don't need a -->
    <!-- side menu.  You should then add class=nomenu to the above div       -->
    <!-- Example: <div class="nomenu" id="mBody">			     -->

	<div id="side"> <!-- Block of text on left side of page -->

<dl class=toc>

<h3>User Guide</h3></dt><DD><UL>
<LI><a href="./Tour.html">Quick tour</A>
<LI><a href="./MoreInfo.html">Details</A>
<LI><a HREF="./Files.html">Configuration files</a>
<LI><a HREF="./Roster.html">Working with the roster</a>
<LI><a HREF="./FAQ.html">Frequently asked questions</a>
<LI><a HREF="./Install.html">Downloading and installing DecoderPro</a>
</UL>

<dt><h3>More advanced information</h3></dt><DD><UL>

<LI><a HREF="./IntroXML.html">Intro to XML files</a>
<LI><a href="./CreateDecoder.html">Create your own decoder definition</a>
<LI><a href="./Programmer.html">Create a custom programmer definition</a>
<LI><a HREF="./RosterFile.html">How the roster is stored; updating it by hand</a>
<LI><a HREF="./LocoFile.html">Locomotive (roster) files</a>
<LI><a HREF="./Debug.html">Debugging</a>
</UL>

</dl>

	</div> <!-- End of block of text on left side of page -->

<div id="mainContent">

<div class="list">
<H2>JMRI: DecoderPro User Guide - How DecoderPro Identifies Decoders</h2>


<P>
To properly program a decoder, DecoderPro needs to be able to 
find a "definition" for the decoder.  That definition specifies which CVs are
understood by the decoder, what they mean, what values are valid, etc.

<P>
DecoderPro allows a user to pick which decoder model they have installed,
in which case it can automatically find the right definition.  But it 
also provide an "Ident" function which attempts to locate the right definition
based on information it reads from the decoder.

<P>
Ident starts by reading the manufacturer code from CV8.  The NMRA has
defined a set of unique values for this CV.  Since (almost) all decoders
properly provide this information, DecoderPro can use it to narrow-down the
list of possible definitions to just those from a particular manufacter.

<P>
Next, DecoderPro reads the value from CV7.  The NMRA has defined this as
the "version" number.   Unfortunately, not all manufacturers use this number
in a way that provides necessary information.  There are two ways that
this can go wrong:
<OL>
<LI>Too many decoders with the same version number.  
<P>
If many different types of decoders have the same version number, and if
those versions differ enough, then the version number doesn't provide enough
information to pick a specific definition.
<P>
For example, if version number 3 can be found in both a low-cost decoder with
few CVs, and in a high-function decoder with lots of CVs, finding a 3 in CV7 doesn't
provide enough information.
<P>
This problem happens most often when a particular model can have a range of version
numbers in CV7, and those ranges overlap from one model to another.

<LI>Not enough information available about what a version number means.
<P>
Some manufacturers don't release any information about how the version numbers
can be used to identify particular decoders.  For example, they might 
</OL>

<P>
In addition to using the version number in CV7, DecoderPro can look at values in 
other, manufacturer-specific CVs to identify the decoder.  This can be very powerful, as
manufacturers can use their own CVs to make as much information available as desired.
<P>
Unfortunately, even those manufacturers who use additional CVs for identification information
rarely make the meaning of values in those CVs publicly available.
We then have to deduce what a 103 in a particular CV means, and we often get it wrong.

<P>
It's important to note that there are good business reasons for some of the things
that manufacturers have done with identification information so far.  For example:
<UL>
<LI>Manufacturers often use the same processor chip and software in multiple decoder 
models; it would
be cost-prohibitive to change the chip to have a unique identification code for 
each specific model.  
<P>
But we don't need a unique tag for each model.  We only need to identify what CVs
are present and what they mean; two decoders that are running the same software will
have the same CVs present.  (We handle as a special case the number of outputs that
are physically available, etc)

<LI>Manufacturers are concerned that users and dealers will use the version identification
information to identify "stale stock", and insist on free updates to the most recent
version.  This would be a huge economic burden to the manufacturer, particularly given 
that most requests might be motivated by a desire to for a "latest and greatest" rather
than the need for specific bug to be fixed.
<P>
It's important to note, however, that we don't need to be able to identify the specific version
of firmware per se; we only want to identify the CV programming needed.  Internal changes
need not effect the identification information.
</UL>
<h3>Recommendations</h3>
What should a responsible manufacturer do?

<P>
Generally:
<UL>
<LI>Have a plan for how to identify the feature set and CVs of a decoder,
and disclose that plan to users.  It might be something like "you can look in CV7 
and CV150 to identify the features of a decoder".  To deal with the history
of past decoders, etc, it might have to be more complicated:  "Match the values in
CV7, CV150 and CV 188 to the possible values on this web page".  We'll find a way
to deal with anything that can be described in terms of CV values.

<LI>As new types of decoders are produced, make sure to publish the specific information
needed to identify the decoder.  This might be as simple as putting the identification
values on a web page for the decoder. (Since the values might change, putting them in an 
manual is of limited use)
</UL>

Beyond that:

<UL>
<LI>The most value for the customer would come if a <em>specific</em> model
can be identified. An additional CV for this would be ideal, but any method of
narrowing down to a model 2XYZ123AB decoder would be ideal.

<LI>
If concerned about separating "firmware update version" from "feature set", consider
using separate CVs for that, and perhaps not even making the "firmware update" information
available to users.

<LI>
An easy way to handle older decoders when moving to a new method is to identify a 
specific CV7 value that hasn't been used, and define that as a flag that other CVs
should be consulted for more information.

<LI>
When new features are added to a decoder, consider calling it a new model.  Having 
many different versions of the XYZ123 decoder, some with BEMF, some without, some with
special lighting options, some without, etc, confuses both the customer and the people
trying to support customers with software like DecoderPro.  And why not get credit for
the new features from people who'll ask for the new model?

</UL>

<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 1997 - 2004 JMRI Community. 
	<P>JMRI, DecoderPro, PanelPro, DispatcherPro and associated logos are our trademarks.
	<P><A href="/Copyright.html">Additional information on copyright, trademarks and licenses is linked here.</a></p>
    
       <BR>Site hosted by: <BR>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

</div><!-- closes #mainContent-->
</div> <!-- closes #mBody-->
</body>
</html>

