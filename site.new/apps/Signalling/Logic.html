<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
    <TITLE>
 	JMRI: Simple Signal Logic
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <meta name="keywords" content="JMRI Signaling Signalling  PanelPro">

    <!-- The combination of "Define" and {Header,Style, Logo and Footer} comments -->
    <!-- are an arbitrary design pattern used by the update.pl script to -->
    <!-- easily replace the common header/footer code for all the web pages -->

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
    <p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="/images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->

    <hr class="hide">

    <div class="nomenu" id="mBody">
	<div id="mainContent">
	    <!-- -------- -->
	    <!--  Teaser  --> <!-- Optional -->
	    <!-- -------- -->

	    <div id="teaser">
		<h1>Update:</h1>

		    <p class=important>
		    	Actual code has been added below for 
		    	those who want to look at the details
		    </p>
	    </div> <!-- closes #teaser-->

	    <!-- -------- -->
	    <!-- Page TOC --> <!-- Optional -->
	    <!-- -------- -->

	    <H1>Table of Contents</H1>
	    <ul class=snav>
		<li><a href="#single">Logic for single block</a></li>
		<li><a href="#trailmain">Logic for trailing-point main block</a></li>
		<li><a href="#traildiv">Logic for trailing-point diverging block</a></li>
		<li><a href="#face">Logic for facing-point main block</a></li>
	    </ul>

	    <!-- ------------- -->
	    <!-- Page Contents --> <!-- Required -->
	    <!-- ------------- -->

	    <H1>JMRI: Simple Signal Logic</H1>
		<p class=subtitle>
		    Background information of the logic used to control simple signals
		</p>

		<div class=para>
		<p>This page describes the logic used by the JMRI Simple
		Signal panel to control signals.</p>
		</div>
	
			<div class=section><a id="single">
		    <h2>On Single Block</h2>

		    <div class=para>
		    <p>This signal protects one end of a straight through block, 
		    with no signaled turnouts.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doSingleBlock() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>

			<div class=section><a id="trailmain">
		    <h2>On Main Leg of Trailing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is along the main route through a turnout, which is 
		    defined as the direction taken by trains when the turnout is closed. 
		    It's protecting the frog of the turnout so that trains will stop before 
		    running through a turnout set against them.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doTrailingMain() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchTurnout!=null && watchTurnout.getKnownState() != Turnout.CLOSED)
            appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>


			<div class=section><a id="traildiv">
		    <h2>On Diverging Leg of Trailing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is along  the diverging route through a 
		    turnout, which is defined as the direction 
		    taken by trains when the turnout is set to "thrown". 
		    It's protecting the  frog of the turnout so that trains 
		    will stop before running 
		    through a turnout set against them.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doTrailingDiverging() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchTurnout!=null && watchTurnout.getKnownState() != Turnout.THROWN)
            appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>


			<div class=section><a id="face">
		    <h2>On Facing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is protecting the points-end of a turnout. 
		    Depending on whether the turnout is thrown or closed, the 
		    train will take two different routes, and the 
		    signal will protect different next blocks.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doFacing() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();

        // find signal to watch
        SignalHead s = watchedSignal1;
        if (watchTurnout!=null && watchTurnout.getKnownState() == Turnout.THROWN )
            s = watchedSignal2;

        // check for yellow, flashing yellow overriding green
        if (s!=null && protectWithFlashing && s.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (s!=null && s.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>


<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 2003,2004 JMRI Community</p>
        <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

	  </div><!-- closes #mainContent-->
	</div> <!-- closes #mBody-->
</body>
</html>

