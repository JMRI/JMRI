<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<TITLE>
JMRI: Layout Automation
</TITLE>
<META http-equiv=Content-Type content="text/html; charset=iso-8859-1">

<META content="Bob Jacobsen" name=Author>
<META content="John Plocher" name=Author>

<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="keywords"
content="java model railroad JMRI dcc nmra layout automation">

<link rel="stylesheet" type="text/css" href="../../css/default.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../css/print.css" media="print">
<link rel="icon" href="../images/jmri-16.png" type="image/png">
<link rel="home" title="Home" href="http://JMRI.sourceforge.net/">
</head>

<body>
<p class="skipLink"><a href="#mainContent" accesskey="2">Skip to main content</a></p>

<!-- Define logo /images/logo-jmri.gif -->
<!-- Define logoalt "JMRI Logo" -->
<!-- Header -->
    <div id="header">
	<!-- Logo -->
	<a href="/" title="Return to home page" accesskey="1">
	    <img src="//images/logo-jmri.gif" width="160" height="135" alt="JMRI Logo"> </a>
	<!-- /Logo -->
	<ul id="mainNav"> <!-- Top tool bar -->
	   <li><a href="/download/"  title="Get the latest software">Download</a></li>
	   <li><a href="/apps/"      title="Learn about JMRI applications">Applications</a></li>
	   <li><a href="/hardware/"  title="What hardware does JMRI support">Hardware</a></li>
	   <li><a href="/doc/Manual/"   title="Trouble-shooting, and FAQs">Manual</a></li>
	   <li><a href="/doc/Technical/" title="Developing and extending JMRI">Developers</a></li>
	   <li><A href="/community/" title="Who is JMRI">Acknowledgements</a></li>
	</ul>

	<div id="searchform"> <!--  Search Form -->
	  <form id="search" method="get" action="http://www.google.com/custom">
	     <label for="q" title="Search JMRI.SourceForge.net">search JMRI: </label>
	     <input type="hidden" name="cof" value="LW:200;LH:95;L:http://JMRI.sourceforge.net/images/logo.gif;GIMP:#cc0000;T:black;ALC:#0000ff;GFNT:grey;LC:#990000;BGC:white;AH:center;VLC:purple;GL:0;GALT:#666633;AWFID:9262c37cefe23a86;">
	    <input type="hidden" name="domains" value="JMRI.sourceforge.net">
	    <input type="hidden" name="sitesearch" value="JMRI.sourceforge.net">
	    <input type="text" id="q" name="q" accesskey="s" size="30">
	    <input type="submit" id="submit" value="go">
	  </form>
       </div> <!--  End #searchform -->
    </div> <!-- closes #header-->
<!-- /Header -->






<hr class="hide">

<div class="nomenu" id="mBody">
<div id="mainContent">
<!-- Page Body -->
<H2>JMRI - Layout Automation</h2>

<p>This page describes the JMRI Java classes that support writing
"automation" code in Java for your layout.  That's things like
operating signals, running trains, and even subtle things like
changing decoder sound volumes when a train goes into a tunnel.</p>

<p>Note that you can also do automation via scripts.  For simple
operations, this is probably preferred, because you don't have to
worry about Java compilations, etc.  For more information, please
see the
<a HREF="../PacketScript">PacketScript page</a>.



</p>

<dl>
<dt class=left>Introduction</dt>
<dd class=first>
<p>The "Automat" class provides an easy way to write Java automation
for your layout using JMRI.</p>

<p> The key class is
<a HREF="../../Technical/doc/jmri/jmrit/automat/AbstractAutomaton.html">AbstractAutomaton</a>,
which provides threading support to simplify custom automation code.</p>

<p>Key aspect: These run in a separate thread, so they can wait for
something to happen while the rest of the program proceeds.
Effectively, each Automat is a separate program running when it
needs to.

<p> There are several examples:
<ul>
<li>SampleAutomaton - watches a Sensor, and adjusts the
state of a Turnout so that it matches the Sensor's state.
<li>SampleAutomaton2 - watches a Sensor, and adjusts
the momentum of a locomotive decoder using ops-mode programming
when the sensor state changes.
<li>SampleAutomaton3 - runs a locomotive back and forth
on a piece of track by watching two sensors, reversing the locomotive
when they change state.
</ul></p>

<p>These can be started from the "Development" Menu of the JmriDemo
application.  Note that they may not do anything useful on your
railroad, as they have block and locomotive numbers hard-coded.
They're meant to be examples for your own programming, not useful
tools.
</dd>

<dt class=left>Controlling Locomotives</dt>
<dd>
<p class=example>
// get the throttle instance for short address 3<br>
throttle = getThrottle(3, false);
</p>

<p> This code snippet assigns "short address 3" to the "throttle"
variable (the "false" selects short address; long address would have
been "true").  If this doesn't work for some reason, you'll get a
periodic "still waiting for throttle" message in the Java window, and
the program will wait.</p>
</dd>

<dt class=left>Interacting with the user</dt>
<dd>
<p>You can put up some message boxes directly from Java, but it takes a little
code to do it.  To simplify it at the start, I've added a "MsgFrame" helper
class to the JMRI library. </p>

<p> To make a message box, you first make an object of the "MsgFrame" class:</p>
<p class=example>
MsgFrame box = new MsgFrame();
</p>

<p>(You can call it whatever you'd like, of course).  That line should go
with the other declarations, e.g. right after the "DccThrottle throttle =
null;" line.</p>

<p> Then, inside the test routines, there are a few things you can do.  To
show a message and wait for the user to click a "Continue" button, do:

<p class=example>
box.show("my message text goes here", true);
</p>


<p>The 2nd argument shows the "Continue button and waits if true, and just
continues if false.  So if you'd like to show a status message while the
program continues to run, do:</p>

<p class=example>
box.show("status message text", false);
</p>

<p>If you've done that, you can change the message with another "show", or
you can make the box go away with:</p>

<p class=example>
box.hide();
</p>

<p>Java actually has to do some work to pop the box and draw it.  We don't
want that to delay the main test program, so I've written this helper class
to do all that kind of work as a 2nd, lower priority.  You should be able
to put messages up on the screen without significantly slowing operation
down (unless the program waits for the "Continue" button to be pressed, of
course).  And waiting for "Continue" to be pressed won't stop the operation
of the rest of the program.</p>
</dd>

</dl>

<!-- Footer -->
    <hr class="hide">
    <div id="footer">
	<ul id="bn">
	<li><a href="/sitemap/">Site Map</a></li>
	<li><a href="/contact/">Contact Us</a></li>
	</ul>

	<p>Thanks and congratulations to
	   <A href="/community/" title="Who is JMRI">
	   	all who contributed</A>! </p>

	<p>Copyright &copy; 2003,2004 JMRI Community</p>
        <BR/>Site hosted by: <BR/>
        <A href="http://sourceforge.net"> 
        <IMG src="http://sourceforge.net/sflogo.php?group_id=26788&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"> </A> 


    </div>
<!-- /Footer -->

</div><!-- closes #mainContent-->
</div> <!-- closes #mBody-->
</body>
</html>

