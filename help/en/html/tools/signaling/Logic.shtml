<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<!-- Copyright Bob Jacobsen 2008 -->
<!-- $Id: Logic.shtml,v 1.1 2008-02-17 04:51:57 jacobsen Exp $ -->
<title>JMRI: Simple Signal Logic</title>

<!-- Style -->
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
<link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
<link rel="icon" href="/images/jmri.ico" TYPE="image/png">
<link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<body>
<!--#include virtual="/Header" -->

<!--#include virtual="Sidebar" -->
<div id="mainContent">


<H1>JMRI: Simple Signal Logic</H1>
<p class=subtitle>
    Background information of the logic used to control simple signals
</p>

<div class=para>
<p>This page describes the logic used by the JMRI Simple
Signal panel to control signals.</p>
</div>

    <div class=section><a id="single">
    <h2>On Single Block</h2>

    <div class=para>
    <p>This signal protects one end of a straight through block, 
    with no signaled turnouts.</p>
    </div>

    <div class=para>
<pre class=code>
    void doSingleBlock() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>

			<div class=section><a id="trailmain">
		    <h2>On Main Leg of Trailing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is along the main route through a turnout, which is 
		    defined as the direction taken by trains when the turnout is closed. 
		    It's protecting the frog of the turnout so that trains will stop before 
		    running through a turnout set against them.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doTrailingMain() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchTurnout!=null && watchTurnout.getKnownState() != Turnout.CLOSED)
            appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>


			<div class=section><a id="traildiv">
		    <h2>On Diverging Leg of Trailing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is along  the diverging route through a 
		    turnout, which is defined as the direction 
		    taken by trains when the turnout is set to "thrown". 
		    It's protecting the  frog of the turnout so that trains 
		    will stop before running 
		    through a turnout set against them.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doTrailingDiverging() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();
        // check for yellow, flashing yellow overriding green
        if (watchedSignal1!=null && protectWithFlashing && watchedSignal1.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (watchedSignal1!=null && watchedSignal1.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchTurnout!=null && watchTurnout.getKnownState() != Turnout.THROWN)
            appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

		    </div>


			<div class=section><a id="face">
		    <h2>On Facing-Point Turnout</h2>

		    <div class=para>
		    <p>This signal is protecting the points-end of a turnout. 
		    Depending on whether the turnout is thrown or closed, the 
		    train will take two different routes, and the 
		    signal will protect different next blocks.</p>
		    </div>

		    <div class=para>
<pre class=code>
    void doFacing() {
        int appearance = SignalHead.GREEN;
        int oldAppearance = ((SignalHead)outputs[0]).getAppearance();

        // find signal to watch
        SignalHead s = watchedSignal1;
        if (watchTurnout!=null && watchTurnout.getKnownState() == Turnout.THROWN )
            s = watchedSignal2;

        // check for yellow, flashing yellow overriding green
        if (s!=null && protectWithFlashing && s.getAppearance()==SignalHead.YELLOW)
            appearance = SignalHead.FLASHYELLOW;
        if (s!=null && s.getAppearance()==SignalHead.RED)
            appearance = SignalHead.YELLOW;

        // check for red overriding yellow or green
        if (watchSensor1!=null && watchSensor1.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor2!=null && watchSensor2.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor3!=null && watchSensor3.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;
        if (watchSensor4!=null && watchSensor4.getKnownState() != Sensor.INACTIVE) appearance = SignalHead.RED;

        // show result if changed
        if (appearance != oldAppearance)
            ((SignalHead)outputs[0]).setAppearance(appearance);
    }
</pre></div>

</div>

<!--#include virtual="/Footer" -->
</body>
</html>

