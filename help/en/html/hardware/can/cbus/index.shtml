<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">

<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.17), see www.w3.org">
  <meta name="keywords" content="MERG CBUS supports JMRI help support">
  <title>JMRI Hardware Support - MERG CBUS Main Support</title>
  <!-- Style -->
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii">
  <link rel="stylesheet" type="text/css" href="/css/default.css"
  media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css"
  media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
  <!-- /Style -->
</head>

<body>
  <!--#include virtual="/Header" -->
  <div id="mBody">
      <!--#include virtual="Sidebar" -->
    <div id="mainContent">

     <h1>JMRI Hardware Support: MERG CBUS Main Support Page</h1>
      <ul class="snav">
        <li><a href="#documentation">JMRI Documentation</a></li>
        <li><a href="#connecting">Connecting</a></li>
        <li><a href="#cbusevents">MERG CBUS Events</a></li>
        <li><a href="#dcc">DCC over MERG CBUS</a></li>
        <li><a href="#signalling">Signalling</a></li>
        <li><a href="#thirdparty">3rd Party / Support</a></li>
      </ul>
      
        <img src="http://mergcbus.sourceforge.net/cbus.png" align=
      "right" alt="MERG CBUS logo" height="45" width="90">
        <img src=
      "https://www.merg.org.uk/merg_images/merg_logo.png" align=
      "right" alt="MERG logo" height="48" width="102">
      
    <h2><a name="documentation" id="documentation">JMRI Documentation</a></h2>
      <div>
      <p>As support for MERG CBUS continues to evolve, 
      this is not a definitive MERG CBUS network guide. </p>
      
      <p>These JMRI user guides contain considerable simplification of the MERG CBUS scheme, 
      and are aimed at helping new users to JMRI or MERG CBUS, not systems developers. </p>
      
      <p> The latest developers guide and full specification is held on the
      <a href="#thirdparty" >MERG CBUS wiki</a> hosted by MERG.</p>
      
     <h3>JMRI MERG CBUS Support Pages</h3>
        <ul>
        <li><a href="index.shtml">JMRI MERG CBUS Support</a> This Page
            <ul>
            <li><a href="#documentation">JMRI Documentation</a></li>
            <li><a href="#connecting">Connecting</a></li>
            <li><a href="#cbusevents">MERG CBUS Events</a></li>
            <li><a href="#dcc">DCC over MERG CBUS</a></li>
            <li><a href="#signalling">Signalling</a></li>
            <li><a href="#thirdparty">3rd Party / Support</a></li>
            </ul>
      </li>
      <li><a href="Names.shtml">Naming events in JMRI</a>
        
            <ul>
            <li><a href="Names.shtml#events">Event Name and Numbering</a></li>
            <li><a href="Names.shtml#sysname">System Names</a></li>
            <li><a href="Names.shtml#summary">Summary of MERG CBUS Events</a></li>
            <li><a href="Names.shtml#namingspec">Event Naming Specification</a></li>
            <li><a href="Names.shtml#hex">Sending hex strings</a></li>
            <li><a href="Names.shtml#opc">Op Codes in JMRI</a></li>
            </ul>        
        
        </li>
        <li><a href="Details.shtml">Connection Details</a> - MERG CAN connection options in the main JMRI preferences.
        
            <ul>
            <li><a href="Details.shtml#c1">CAN via MERG CAN-RS or CAN-USB</a></li>
            <li><a href="Details.shtml#c2">CAN via MERG Network Interface</a></li>
            <li><a href="Details.shtml#c6">CAN Simulation</a></li>
            </ul>
        </li>
        <li><a href="../index.shtml">JMRI CAN Support</a></li>
        <li><a href="../scripting.shtml">JMRI Scripting for CAN frames ( jython )</a></li>
        </ul>

    <a name="tools" id="tools"></a>
    <h3>JMRI MERG CBUS Tools Support Pages</h3>
      <img src="images/swing/merg-menu-206x145.png" alt="MERG menu" align="right"
      width="206" height="145">

      <ul>
        <li><a href=
        "../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml">
        Console</a> - Tool for viewing and sending CAN frames / events.
            <ul>
            <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml#logtofile"
            >Logging to a File</a></li>
            <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml#stats"
            >Statistics</a></li>
            <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml#filter"
            >Filter</a></li>
            <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml#highlighter"
            >Event Highlighter</a></li>
            </ul>
        </li>

        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/eventtable/EventTablePane.shtml">
        Event Table</a> - Monitors events and presents them in a table full of statistics.
           <ul>
           <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/eventtable/EventTablePane.shtml#stats"
           >Event Statistics</a> On / Off / In / Out </li>
        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/eventtable/EventTablePane.shtml#importexport"
        >Table Import and Export</a></li>
           </ul>
        </li>

        <li><a href=
        "../../../../package/jmri/jmrix/can/cbus/swing/nodeconfig/NodeConfigToolPane.shtml">
        Node Manager</a> - Node Table and node configuration tools.
        
        <ul>
        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/nodeconfig/NodeConfigToolPane.shtml#variables"
            >Node Variables</a></li>
        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/nodeconfig/NodeConfigToolPane.shtml#events"
            >Node Events</a></li>
        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/nodeconfig/NodeConfigToolPane.shtml#nodenumber"
            >Node Numbers</a></li>
        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/nodeconfig/NodeConfigToolPane.shtml#fcuimport"
            >Import MERG FCU xml file - Restore NV's and Events, Import CBUS event names</a></li>
        </ul>
        </li>
        
        <li>
        <a href="../../../../package/jmri/jmrix/can/cbus/swing/cbusslotmonitor/CbusSlotMonitorPane.shtml">
        Command Station Monitor</a> - Loco session monitoring and Command Station Tools.
        </li>
        
        <li><a href="../../../../package/jmri/jmrix/can/swing/send/CanSendFrame.shtml"
        >Send Frame</a> - Send CAN frames or MERG CBUS events
        
            <ul>
            <li><a href="../../../../package/jmri/jmrix/can/swing/send/CanSendFrame.shtml#sequencer"
            >Sequencer</a> Send a sequences of event frames in a loop </li>
            </ul>
        </li>

        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/configtool/ConfigToolFrame.shtml"
        >Event Capture Tool</a> - Capture MERG CBUS events
        </li>

        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/eventrequestmonitor/CbusEventRequestTablePane.shtml"
        >Event Request Monitor</a> - Request Event status monitoring tool
        </li>

        <li><a href="../../../../package/jmri/jmrix/can/cbus/swing/simulator/SimulatorPane.shtml"
        >Network Item simulation</a> - Simulates Cbus Command stations and responds to event requests
        </li>

      </ul>
      </div>
    <h2><a name="connecting" id="connecting">Connecting</a></h2>
      <div>
      <h3>Typical first-time Connection Steps</h3>
      <ul>
      <li>Many Modern Operating Systems do not require device drivers to be installed 
      when connecting a MERG CANUSB4 to a computer.
      <br>Plug in, and check that no major error messages appear. </li>
      <li>Install JMRI</li>
      <li><a href="Details.shtml">Connection Preferences</a> - Select MERG connection, 
      use "CAN via MERG CAN-RS or CAN-USB" for a CANUSB4 with default settings.
      <br>You could also choose CAN Simulation if you have no physical connection to a MERG CBUS network.
      </li>
      <li>Save / Restart JMRI</li>
      <li>If you are using DCC over the MERG connection, check that JMRI Preferences > Defaults 
      are set correctly, see <a href="#dcc">DCC over MERG CBUS</a>.
      </li>
      <li>A new menu item MERG appears in the PanelPro or DecoderPro window, containing the MERG tools.
      <br>Help > Window Help will show relevant info in the tools and any JMRI window.</li>
      <li>Test events can be sent from the MERG <a href=
        "../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml">Send CAN Frame tool</a>.  
      <br>
      Set the test event, eg Frame packets "+1" and / or "-2" ( without the quotation marks ), 
      waiting 500 msec and click Start Sending to generate steady MERG CBUS network traffic.
      <br>
      Check that these events are actually being sent over the MERG CBUS network by using a module such as a CANACT.</li>
      <li>Use an external producer module to test connectivity receiving events, confirming they appear in the <a href=
        "../../../../package/jmri/jmrix/can/cbus/swing/console/CbusConsoleFrame.shtml">MERG CBUS console</a>.
      </li>
      <li>The <a href="../../../../package/apps/SystemConsole.shtml">JMRI System Console</a>
      is a good tool for diagnosing issues during setup and operation. </li>
      </ul>
       </div>
      
      <h2><a name="cbusevents" id="cbusevents">MERG CBUS Events</a></h2>
      <div>
      
      <p>MERG CBUS events are transmitted as a one-to-many network, 
      connected modules receive all network data then choose whether or not to act on them.
      <br>This enables multiple modules to act on a single event, eg : </p>
      
      
            <ul>
            <li>A physical turnout ( UK - point ) microswitch sensor is wired to a 
            MERG CBUS <b>producer</b> module . 
            <br>The module has been taught to send a particular event when the switch is closed.</li>
            <li>This event is received by a relay driver ( <b>consumer</b> ), which changes the frog polarity.</li>
            <li>The event is also received by an LED module which has not been taught the event, so does nothing.</li>
            <li>The event is also received by an LED module ( <b>consumer</b> ), lighting a LED on a mimic panel.</li>
            <li>The event is also received by JMRI ( <b>consumer</b> )
            <li>A <a href="../../../tools/Sensors.shtml">JMRI sensor</a> has been created with the event number, 
            causing the sensor status to change
            <br>A <a href="../../../tools/Turnouts.shtml">JMRI turnout</a> ( point ) has its 
            <a href="../../../../package/jmri/jmrit/beantable/TurnoutTable.shtml#Turnout_Feedback"
            >turnout feedback</a> set by this sensor.
            <br>
            <a href="../../../apps/PanelPro/index.shtml">JMRI panel(s)</a>
            update to reflect the new point position.</li>
            <li><a href="../../../tools/signaling/SignalMastLogic.shtml"
            >JMRI Signalling Logic</a> recalculates, and on the JMRI panel, 
            a signal protecting the point changes from Red to Green.
            </li>
            
            <li>The <a 
            href="../../../tools/signaling/SignalMasts.shtml">JMRI Signal Mast</a> 
            mapping is checked and the relevant MERG CBUS event is sent to change 
            that on the layout ( <b>producer</b> ) </li>
            <li>This event is received by a LED ( or servo ) module which changes 
            a physical on-layout signal ( <b>consumer</b> ) </li>
            <li>This event is also received by a LED module which changes a signal 
            on a mimic panel ( <b>consumer</b> )</li>
            
            <li>A train, controlled by (  <a href="../../../../package/jmri/jmrit/dispatcher/Dispatcher.shtml"
            >JMRI DispatcherPro</a> for a <a href="../../../../package/jmri/jmrit/display/LayoutEditor.shtml"
            >JMRI Layout Editor</a> Panel ) or ( 
            <a href="../../../../package/jmri/jmrit/logix/Warrant.shtml">JMRI Warrants</a> for a <a 
            href="../../../../package/jmri/jmrit/display/ControlPanelEditor.shtml"
            >JMRI Control Panel Editor</a> panel ),<br> sees that the signal ahead 
            has cleared and can increase its speed.
            
            <br>DCC commands are generated from JMRI and sent over MERG CBUS using 
            special events ( <b>producer</b> ) </li>

            <li>These MERG CBUS events are received by a MERG CANCMD ( <b>consumer</b> ), 
            which then sends the actual DCC command out to the track or boosters.
            <br>
            
            <br>This train had requested the section ahead of it, JMRI Dispactcher/Warrants 
            had allocated it ( after checking occupancy and other rules ), 
            then sent the turnout event ( <b>producer</b> ) to change the points.
            <br>The event was received by a Servo or solenoid module ( <b>consumer</b> ) 
            which had triggered correctly, changing the point sensor right at the top of this example.
            
            <br>
            <br>
            </li>
            

            
            <li>You can start small and think big, 
            adding more modules as your time and experience allows.

            <br>Many people use MERG CBUS and JMRI purely for displaying turnout positions, 
            adding things like track occupancy, on-layout signals, mimic panels etc. at a later date.
            
            
            <br>If you anticipate adding track occupancy, 
            especially track circuit electrical block ( Train On Track Indicators ),
            ideally plan the electrical scheme for this on your layout at any early stage.
            
            </li>

            </ul>
      
      
      <p>MERG CBUS events generally come in two types: "ON" and "OFF".</p>
      
      <p>Events can be short ( SLiM ) events, eg <code>+11</code> for event 11 on.</p>
      
      <p>Events can be long ( FLiM ) events, eg <code>-N2E7</code> for node 2 event 7 off.</p>
      
      <p>JMRI, being both a <b>consumer</b> and <b>producer</b> of events, 
      can send and receive on any node number and any event.</p>
      
      </div>
      
   <h3>Adding events to JMRI</h3>
    <div>
      <img src="images/web/merg-cbus-add-light-short-400x292.png" align="right"
      alt="merg cbus add light" width="400" height="292">
    
      <p>MERG CBUS events are stored as </p>
      <ul>
      <li><a href="../../../tools/Sensors.shtml" title="JMRI Sensors">JMRI Sensors</a> ( Inputs ) 
      </li>
      <li><a href=
      "../../../tools/Turnouts.shtml" title="JMRI Turnouts">JMRI Turnouts</a> ( Outputs )
      </li>
      <li><a href=
      "../../../tools/Lights.shtml" title="JMRI Lights">JMRI Lights</a> ( Outputs ).</li>
      </ul>
      
      <p>These are accessed via JMRI Tables, ie PanelPro > Tools > Tables > (

       <a href="../../../../package/jmri/jmrit/beantable/SensorTable.shtml" title="JMRI Sensor Table">Sensors</a>,
       <a href="../../../../package/jmri/jmrit/beantable/TurnoutTable.shtml" title="JMRI Turnout Table">Turnouts</a> or
       <a href="../../../../package/jmri/jmrit/beantable/LightTable.shtml" title="JMRI Light Table">Lights</a> ) .

      <br>When the table loads, click on " Add... " button at bottom left to create an item.</p>
      
    <img src="images/web/merg-cbus-add-sensor-short-781x187.png" alt="merg cbus add sensor" width="646" height="155">
    
      <p>For most short events, you just need to enter the number. Here's a few examples : </p>
      
      <img src="images/web/merg-cbus-turnout-long-400x118.png" alt="merg cbus add turnout" width="400" height="118" align="right">
      
      <table border="1">
        <tbody>
        <tr>
          <th>Hardware Address</th>
          <th>Meaning</th>
          <th>Event Consumed<br>as Sensor</th>
          <th>Event Produced<br>as Turnout</th>
          <th>Event Produced<br>as Light turned</th>
        </tr>
        <tr>
          <td><code>+18</code></td>
          <td>Event 18 On
          <br>Event 18 Off</td>
          <td>Sets sensor Active<br>Sets sensor Inactive</td>
          <td>Thrown<br>Closed</td>
          <td>On<br>Off</td>
        </tr>
        <tr>
          <td><code>+18;+21</code></td>
          <td>Event 18 On
          <br>Event 21 On</td>
          <td>Sets sensor Active<br>Sets sensor Inactive</td>
          <td>Thrown<br>Closed</td>
          <td>On<br>Off</td>
        </tr>
        <tr>
          <td><code>+18;-21</code></td>
          <td>Event 18 On 
          <br>Event 21 Off</td>
          <td>Sets sensor Active<br>Sets sensor Inactive</td>
          <td>Thrown<br>Closed</td>
          <td>On<br>Off</td>
        </tr>
        <tr>
          <td><code>+N2E18</code></td>
          <td>Node 2 Event 18 On
          <br>Node 2 Event 18 Off</td>
          <td>Sets sensor Active<br>Sets sensor Inactive</td>
          <td>Thrown<br>Closed</td>
          <td>On<br>Off</td>
        </tr>
        </tbody></table>
        
        <img src="images/web/merg-add-sensor-invalid-400x124.png" align="right" 
        alt="merg cbus add new invalid name" width="400" height="124">
    
        <p>You will need to enter the Hardware Address in a JMRI recognised format to create the event.
        <br>If the create button is grayed out, check your hardware naming format.</p>
        
        
        
        <p>Adding a User Name ( using any characters ) when creating a table item may 
        make accessing it easier in JMRI. </p>  
        <p>Remember to save your tables!</p>
        
        <p>For more on events, see 
        <a href="Names.shtml">JMRI system naming with MERG CBUS</a>.</p> 
        
        <!--
        A big chunk of text discussing naming options + naming table moved to /help/en/html/hardware/can/cbus/Names.shtml
        @icklesteve June 2018
        -->
        </div>
        
      <h2><a name="dcc" id="dcc">DCC over MERG CBUS</a></h2>
      <div>
        <img src="images/connection/merg-jmri-cbus-preferences-defaults-500x215.png"
        width="500" height="215" alt="JMRI MERG CONNECTION DCC DEFAULT PREFERENCES" align=
        "right">
      
        <p>DCC is not a requirement for MERG CBUS or JMRI. Many DC layouts use 
        MERG CBUS + JMRI for route setting, signalling and track occupancy purposes.
        </p>
      
        <p>JMRI will send and receive the DCC instruction messages over the MERG CBUS network
        and can be monitored within the MERG CBUS console</p>

        <p>Loco sessions are best viewed with the 
        <a href="../../../../package/jmri/jmrix/can/cbus/swing/cbusslotmonitor/CbusSlotMonitorPane.shtml" 
         >CBUS Command Station Monitor</a>, 
        which updates the sessions in a table format.</p>
        
        <p>There are a number of DC Command Stations which have been designed by MERG members
        which use the standard CBUS protocol for requesting and controlling loco sessions.</p>

        <h3>Throttles</h3>
        
        
        <p>All of the programs within the JMRI suite ( including the JMRI WiThrottle server )
        internally share the same command station slot for a given loco address,
        so all of JMRI appears to the command station as a single CANCAB for any single address.</p>

        <p>JMRI ( via the CBUS Node Manager ) can tell if a command station is available which 
        supports the CBUS steal or share feature ( eg. supported with CANCMD v4 + ).</p>
        
        <p>The Steal / Share features are for when throttles are requested which are already in use 
        by something external to JMRI.</p>
        
        <p>When a JMRI application requests a loco ( which is already in a CBUS session ), 
        JMRI will check the main <a 
        href="../../tools/throttle/ThrottlePreferencesPane.shtml">Throttles Preferences</a>.</p>
        
        <p>If Silent Steal or Silent Share has been selected, this will be the default action.</p>
        
        <p>If neither have been checked and you are using the main JMRI Throttle, you will be asked
        if you want to Steal, Share, or cancel.</p>
        
        <img src="images/web/cbus-throttle-steal-share-dialogue-322x128.png"
        width="322" height="128" alt="JMRI MERG CBUS Steal Share Dialogue">
        
        <p>If you are using an automation script and neither option is checked, the system will
        attempt to acquire a Share on the session.</p>
        
        <p>The command station may disable or enable steal / share at any point, 
        so even if you have a preferred option, an automation script may attempt to use
        the non-preferred option to obtain the session.</p>
        
        <h4>Throttles Stolen from JMRI</h4>
        
        <p>When a Throttle session has been stolen / cancelled from outside of JMRI, 
        any open JMRI throttle window for that loco
        will cease to accept commands, ie throttle slider and function keys greyed out.</p>
        
        <p>If Silent Share is enabled in the Throttle Preferences, 
        and share is available on the Command Station,
        after a short delay JMRI will attempt to share the throttle.</p>
        
       <p>For most users, silent sharing enables most layouts to operate with minimum of fuss.</p>
        
        <p>If Silent Steal is enabled in the Throttle Preferences, 
        and steal is available on the Command Station,
        after a short delay JMRI will attempt to steal the throttle back.</p>
        
        <p>Beware of creating Steal loops if more than 1 CAB is capable of auto-stealback!
        If you find this is happening, disable the Silent Stealing option to stop the loop.</p>
        
        <p>If neither option is enabled, or the steal / share is not possible, a notification will be displayed:</p>
        
        <img src="images/web/cbus-throttle-stolen-dialogue-278x138.png"
        width="278" height="138" alt="JMRI MERG CBUS Stolen Throttle Dialogue">
        
        <p>Ticking the checkbox before closing the popup will supress loco steal notifications for
        the rest of the JMRI session, for all loco sessions.</p>
        
        <p>Relevant information can be viewed in the main JMRI Console log.</p>
        
        <p>Note that not all JMRI applications currently have a method for dealing with a stolen throttle.</p>
        
        <h4>Dispatch / Release</h4>
        <p>Dispatch is available according to Command Station Firmware ( eg. supported with CANCMD v4 + )</p>
        <p>Note that as dispatch availability for a single loco address may change, 
        this will be reflected by button availability in the main JMRI Throttle.</p>

        <h3>Consisting</h3>
        <p>The MERG system allows for advanced consisting to be set using CANCMD and CANCABs.</p>
        
        <p>Although the CBUS protocol and CANCMD support Advanced Consisting, 
        this has not been implemented within JMRI at present.</p>
        
        <p><a href="../../../../html/tools/consisttool/ConsistTool.shtml" 
        title="JMRI Consisting">JMRI Consisting</a> 
        : Advanced Decoder Consisting ( Decoder Assisted Consist) is currently unsupported,
        hence this is set to Internal in the CBUS preferences.</p>
        
        <p>Primary Address Consists are supported however.</p>
      
      
      <h3>Connecting a MERG DCC Command Station ( CANCMD , CANCSB etc. )</h3>
        
        <p>On JMRI startup, the CBUS Node Manager will by default search for command stations.</p>
        <p>If a command station responds then it will be added to the node table. </p>
        
        <p>A command station found at startup will also enable the Track Current Meter, 
        available from the main PanelPro > Tools > Track Current Meter.
        <br>This listens for extended event 1 from whichever node number command station 0 is set for.</p>
        <p>The frequency and other settings for this are within the command station node variables.</p>
        
        
        <p>Make sure that main <a href="../../../../package/apps/TabbedPreferences.shtml#Defaults"
        >JMRI Preferences Defaults</a> are set to your MERG connection for 
        Throttles, Power Control, Command Station, Service Programmer and Ops Mode Programmer.</p>
        
      
        <p>You can use an existing DCC command station, 
        or have a separate DCC command station for a programming track 
        ( eg. a <a href="../../../../html/hardware/sprog/SPROG.shtml">Sprog</a> ) by setting these options.</p>

        <p>Events do not need to be set up to connect a MERG DCC Command Station CANCMD.</p>
        
        <p>DCC Accessory Decoders can be controlled over MERG CBUS and a CANCMD 
        by creating turnouts with explicit RDCCx Opscode commands, 
        see <a href="Names.shtml#hex">MERG CBUS hex event naming</a>.
        <br>
        This is also discussed within the <a href="#thirdparty">MERG CBUS WIKI</a> documentation.</p>
        
      <h3>Programming CV's</h3>
    <img src="images/web/merg-dcc-decoders-355x398.png"
        width="355" height="398" alt="JMRI MERG DCC Decoders" align= "right">
        <p>Program train CV's using DecoderPro</p>
        
        <p>CANCMD fully supports DCC CV programming.</p>
        
        <p>There are definitions within DecoderPro for the MERG CANACC5 and other MERG DCC decoders.</p>
        
    </div>
    <h2><a id="signalling" name="signalling">Signalling</a></h2>
      <div>
      <p>There are multiple ways to interface 
      <a href="../../../../html/tools/signaling/index.shtml">JMRI signalling</a> with MERG CBUS modules.</p>
      <p>You are strongly advised to let JMRI control your signal logic, 
      however it's also possible to link JMRI with 3rd party signalling over MERG CBUS.</p>
      
      <p>JMRI includes various UK signalling definitions, a popular choice being 
      <a href="../../../../../../xml/signals/BR-2003/index.shtml">BR2003</a>, however 
      for some layouts <a href="../../../../../../xml/signals/LMS-1932/index.shtml">LMS 1932</a> or <a 
      href="../../../../../../xml/signals/GWR-1931/index.shtml">GWR 1931</a> may be more appropriate.</p>
      
        <p>Once you've got basic signalling setup, you can customise your layout with things like 
        the UK East Coast Main Line flashing green aspects.
        <br>Add JMRI Logix to listen for the correct conditions to display the aspect and send events to the layout.
        </p>
      
      
      
      <h3>Sending JMRI Controlled Signal Logic to your layout</h3>
      
        <img src="images/web/signal-mast-turnout-contolled-400x454.png"
        width="400" height="454" alt="JMRI signal mast turnout controlled" align= "right">
      
      
        <p>There are multiple ways of sending cbus events from JMRI out to LED or servo 
        signal control modules, this is just one approach. </p>
        
        <ul>
        <li>Add all aspects to the signal in question to the Turnout Table, eg
            <br>Signal1Red : Hardware address : <code>+N256E412</code> ( Set Node to whatever your JMRI node is, only uses the ON event )
            <br>Signal1Flashing Precautionary : Hardware address : <code>+N256E416</code>
            <br>Signals which can only display 2 aspects ( eg a Servo controlling a semaphore signal ) 
            can be setup with 1 MERG CBUS event, using the ON and OFF status, eg Signal5RedGreen : <code>+N256E418;-N256E418</code> .
        </li>
        
        <li>It's also worth creating an internal turnout named something like DummySignalOutput.
        <br>You can use this output for signals which have not yet been installed with CAN events but may have in future.
        </li>

        <li>Add the Signal Mast via the Signal Mast Table</li>
        <li>Specify type : Turnout Controlled</li>
        <li>Specify which turnout ( aka JMRI message output ) you 
        wish to show to show for each aspect, eg. Signal1Red Thrown.
        </li>
        
        <li> 
        For virtual signal masts which are not yet physically installed on your layout, 
        use the DummySignalOutput internal turnout created earlier.
        </li>
        </ul>
    
        <p>With this approach, you can easily add and edit which MERG CBUS events are sent 
        from a JMRI controlled signal without editing or re-creating the underlying signal logic.</p>
        <p>It also ensures that only 1 MERG CBUS message is sent for flashing aspects, 
        specify this flashing in the module board, not JMRI!  
        Some Signal Mast types send 1 MERG CBUS message for each flash.
        <br>A layout with 20 quad aspect signals could send 40 odd cbus events every 0.5seconds, 4,800 events per minute. 
        This could make network diagnosis awkward, although very unlikely to swamp a MERG CBUS network.</p>
        <p>As stated previously, this is just one approach. 
        There are may ways of interfacing JMRI with MERG CBUS signalling systems.</p>
        
        
        <hr>
        
        <p>There is initial support for the experimental CabData OPC available in 
        <a href="../../../../package/jmri/jmrit/cabsignals/CabSignalPane.shtml"
        >JMRI CabSignals</a></p>
        
      
      <h3>Receiving Module supplied or existing Signal Logic into JMRI</h3>
      <p>This is normally done the other way round, however people may have 
      existing systems in place which they do not want to change.</p>
      
        <ul>
        <li>Create a virtual Signal Mast, named something like SignalMast7</li>
        <li>Create incoming MERG CBUS event(s) as sensor(s), eg "SignalMast7Red".</li>
        <li>For each signal state ( eg. Stop or Proceed ), 
        create a new <a href="../../../tools/Logix.shtml">JMRI Logix</a> 
        in the <a href="../../../../package/jmri/jmrit/beantable/LogixTable.shtml"
        >JMRI Logix Table</a> to set the signal head or mast as appropriate, similar to
        <br>
        If SignalMast7Red is active, set SignalMast7 to Stop
        </li>
        <li>Repeat for each signal state</li>
        </ul>
    </div>
    <h2><a id="thirdparty" name="thirdparty">Third Party / Support</a></h2>
     <div>
      <ul>
        <li><a href="https://www.merg.org.uk/merg_resources/cbus.php"
        >https://www.merg.org.uk/merg_resources/cbus.php</a>
        The Model Electronic Ralway Group MERG CBUS introduction page.
        </li>
        
        <li><a href="https://www.merg.org.uk/merg_wiki/doku.php?id=public:cbuspublic:start"
        >https://www.merg.org.uk/merg_wiki/doku.php?id=public:cbuspublic:start</a>
        The Model Electronic Ralway Group MERG CBUS Wiki with full protocol specification.
        </li>
      
        <li><a href="https://www.merg.org.uk/merg_resources/cbus-dcc.php"
        >https://www.merg.org.uk/merg_resources/cbus-dcc.php</a> 
        The Model Electronic Railway Group MERG-DCC help page.
        </li>
        
        <li><a href="https://www.merg.org.uk/kits.php#sect35"
        >https://www.merg.org.uk/kits.php</a>
        MERG CBUS kits. Constructing kits may not be an easy task for all, it requires a 
        certain amount of technical ability, and foremost the willingness to learn.
        <br>
        Classic refers to a 15v AC kit power supply ( most <i>easily</i> adaptable for 12v DC ), 2G are all 12v DC kits.
        <br>
        Classic and 2G modules can both be on the same network with an element of care, seek further advice if in any doubt, do not guess!
        <br>
        Reliabiliy soldering MERG kits together may not be the best cbus route for all. 
        If you are in the least bit impatient, you may be better suited to a commercial offering.
        <br>
        If you wish to learn about electronics and their application in a model railway environment however, 
        the member resources available are many and varied!
        </li>

        <li>Please ask for help by other <a href="https://groups.io/g/jmriusers/">JMRI Users at Groups.io</a>, 
        or if a MERG member on the very active MERG members forum.
        </li>
        
        <li>For extra logging while debugging, locate and edit the default.lcf file 
        in the root of the JMRI install, see the pattern at the end of the file.
        <br> General MERG CBUS logging - log4j.category.jmri.jmrix.can.cbus=DEBUG
        <br> Connection logging - log4j.category.jmri.jmrix.can.adapters.gridconnect=DEBUG
        <br>The extra logging will appear in the JMRI console, also the JMRI error logs.
        </li>
        
        <li><a href="https://github.com/JMRI/JMRI/issues?q=is%3Aissue+is%3Aopen+merg"
        >https://github.com/JMRI/JMRI/issues?q=is%3Aissue+is%3Aopen+merg</a> 
        Current known ( open ) issues relating to MERG by the JMRI developers on Github.
        <br>Github is <b>not</b> a support tool.</li>
        
        <li><a href="https://github.com/MERG-DEV">https://github.com/MERG-DEV</a>
        MERG CBUS Development on Github - Much of it is licensed under the GNU General Public License v3.0.
        </li>
        
        <li><a href="https://github.com/phillipsnj/mergCbusServer">https://github.com/phillipsnj/mergCbusServer</a> 
        MERGCBUS Server - enables multiple network connections to a MERG CANUSB4 using 
        <a href="https://nodejs.org">Node.js</a> , MIT License.
        </li>
        
        <li><a href="https://github.com/amaurial/mergCanBus">https://github.com/amaurial/mergCanBus</a>
        MERG CBUS implementation for Arduino. ( + have a look at Amauria's other MERG CBUS Github projects )
        </li>
        
        <li><a href="http://www.oscale.net/?q=en/cbus">http://www.oscale.net/?q=en/cbus</a>
        MERG CBUS on an Arduino using CAN BUS shields - See download links at bottom ( in English + German )
        </li>
        
        <li><a href="https://www.npmjs.com/search?q=keywords:MERG">https://www.npmjs.com/search?q=keywords:MERG</a>
        node.js modules to create a MERG CBUS module + Class to create a MERG CBUS module conneted via ethernet.
        </li>

        <li><a href="http://www.rickdavis.co.uk/rail/control-cbus.php">http://www.rickdavis.co.uk/rail/control-cbus.php</a>
        Middle Earth Model Railway has over 70 MERG CBUS modules installed on it and uses JMRI.
        </li>

        </ul>
        
        
        <p>Originally named CBUS by co-founder Gil Fuchs, MERG CBUS isn't a MERG 
        project and is "open source" or public domain.
        <br>In 2007, when the scheme was being developed, MERG had a website willing to host the project 
        and organised the kits ( many designed by the other MERG CBUS co-founder Mike Bolton ).
        <br>The scheme is now called MERG CBUS to avoid conflict with a home automation 
        system which has trademark on a similar name. </p>
    
        <p>MERG CBUS co-founders : Gil Fuchs, Mike Bolton</p>
        <p>Mike Bolton designed hardware and coded firmware for many of the initial modules, 
        lead for CAN-RS module and code </p>
        
        
        <p>The standalone MERG DCC programmer was the inspiration behind the popular 
        <a href="../../../../html/hardware/sprog/SPROG.shtml">SPROG DCC programmer</a>, which is fully supported in JMRI.</p>
        
        <p>Andrew Crosland has been heavily involved with JMRI through both SPROG and MERG CBUS, 
        writing much code to enable JMRI to support MERG CBUS. 
        <br>Anything to do with CANUSB, CANUSB4 and Gridconnect etc, he's an expert! 
        <br>Andrew also he wrote the MERG CANCMD code and designed the MERG CANUSB4</p>
        <p>Kevin Dickerson was instrumental in writing the original JMRI to MERG CBUS interfaces, supported by Andrew.</p>
        
        <p>Pete Brownlow has updated the CANCMD firmware, also lead for the CANEther module, and the MERG JMRI go-to person!</p>
        
        <p>Amauri Albuquerque has been the main SW writer for the CANPiWi 
        ( based on the RPi Zero W and is an interface between ED/ WiThrottle and CBUS ), and CANPi.
        <br>CANPi is a version of this for a RPi 3B ( with Ian Hart's CAP.)
        </p>
        
        <p>Ian Hart designed the Pi CAP, also the popular CANMIO range of modules.</p>
        
        <p>Roger Healey is also key to the MERG CBUS success story being lead developer on the FCU, 
        a Windows configuration utility for setting up FLiM modules ( independent of JMRI ) </p>
    
        <p>N J Philips established the mergCbusServer and keeps it up to date.</p>
        
        <p>The MERG kit elves who package the kit parts are amazing, 
        having enabled thousands of MERG CBUS module kits to be sent out to members.</p>
        
        <p>The JMRI developers do a fantastic job of keeping updates flowing, making JMRI easier to use on each release :-)</p>
        
        <p>Apologies to anyone missed out or inaccuracies, let us know and I'll gladly edit the page! - SY</p>
        </div>
    
      <!--#include virtual="/Footer" -->
    </div><!-- closes #mainContent-->
  </div><!-- closes #mBody-->
</body>
</html>
