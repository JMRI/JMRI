<html>
<head>
<title>LogixNG Tutorial - Chapter 1</title>
<script type="text/javascript" src="/web/js/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="script.js"></script>
<link rel="stylesheet" href="style.css">
</head>

<body>

<table width="800">
<tr>
<td>

<h1>LogixNG Tutorial - Chapter 1</h1>

<h2>LogixNG - What is it?</h2>

LogixNG is similar to Logix. It's a way to define rules, like <i>"If sensor IS1 is Active, then set turnout IT2 to
Thrown"</i>. It borrows some concepts from Logix, but it's a complete new design and it can work side by side with
Logix.
<p>
<h2>Setting up a LogixNG and a ConditionalNG</h2>

<img src="images/chapter1/create_logixng_1.png">

<p>

First, we create a LogixNG. We start <b>PanelPro</b> and select <b>Tools</b> &rArr; <b>Tables</b> &rArr; <b>LogixNG</b>
&rArr; <b>LogixNG</b> to open the table with LogixNGs.

<p>

<img src="images/chapter1/create_logixng_2.png">

<p>

Click button <b>Add...</b> to add a new LogixNG.

<p>

<img src="images/chapter1/create_logixng_3.png">

<p>

By default, the checkbox <b>Automatically generate System Name</b> is checked for all items in LogixNG.

<p>

Click the button <b>Create</b> to create a LogixNG.

<p>

<img src="images/chapter1/create_logixng_4.png">

<p>

<h3>Then we create a ConditionalNG.</h3>

<p>

Click button <b>New ConditionalNG</b> to add a new ConditionalNG.

<p>

<img src="images/chapter1/create_conditionalng_1.png">

<p>

Click the button <b>Create</b> to create it.

<p>

<hr>

<h2>The ConditionalNG editor</h2>

<img src="images/chapter1/create_conditionalng_2.png">

<p>

A ConditionalNG is a tree of actions and expressions. When the ConditionalNG is created, the tree consist only of a
single female socket, "A". The exclamation mark tells that this is a digital action socket, so you can connect digital
actions to it.

<p>

<img src="images/chapter1/create_conditionalng_3.png">

<p>

To create a new action, we right-click (command-click) with the mouse on the female socket <code>!A</code> and then
select "Add" in the popup menu.

<p>

<img src="images/chapter1/create_conditionalng_4.png">

<p>

We then select which action we want to create. The actions and expressions are organized in categories, so we first
select the category.

<p>

<img src="images/chapter1/create_conditionalng_5.png">

<p>

We then select the action. Lets start with a "Set turnout".

<p>

<img src="images/chapter1/create_conditionalng_5b.png">

<p>

Click on "Create" to create the action.

<p>

<img src="images/chapter1/create_conditionalng_6.png">

<p>

We now get a dialog box there we can select the turnout to control. And what to do with this turnout.

<p>

<img src="images/chapter1/create_conditionalng_7.png">

<p>

In this example, we create a new turnout IT_1_1 and we tell the action to throw the turnout when the action is
triggered.

<p>

Click on "Create" to create this action.

<p>

<img src="images/chapter1/create_conditionalng_8.png">

<p>

The action is now created and each time this ConditionalNG is executed, the turnout IT_1_1 is thrown.

<p>

<hr>

<h3>Adding a expression sensor</h3>

But having a single turnout action in the ConditionalNG will not do much good. Lets change the ConditionalNG so that it
reads sensor IS_1_1 and if it's active, the turnout is thrown.

<p>

To do this, we need to temporary remove the Set turnout action and instead add an IfThenElse action. LogixNG has a
clipboard that allows us to cut and paste actions and expressions. So lets use it to temporary move the Set turnout
action to the clipboard.

<p>

<img src="images/chapter1/create_conditionalng_9.png">

<p>

Right-click (command-click) with the mouse on the Set turnout action and then select "Cut" in the popup menu. The
action is now moved to the clipboard.

<p>

We will not look at the clipboard for now, but as a side note, you can open the clipboard by selecting <b>Tools</b>
&rArr; <b>Clipboard</b> in the ConditionalNG editor.

<p>

<img src="images/chapter1/create_conditionalng_2.png">

<p>

We now have an empty ConditionalNG again.

<p>

We now need to add an If Then Else action.

<p>

<img src="images/chapter1/create_conditionalng_10.png">

<p>

Select the category "Other".

<p>

<img src="images/chapter1/create_conditionalng_11.png">

<p>

Select the If Then Else action. And then click on "Create".

<p>

<img src="images/chapter1/create_conditionalng_12.png">

<p>

Click on "Create" to create the If Then Else action.

<p>

<img src="images/chapter1/create_conditionalng_13.png">

<p>

We now have a ConditionalNG with the If Then Else action.

<p>

<img src="images/chapter1/create_conditionalng_14.png">

<p>

Right-click (command-click) with the mouse on the Then socket and select "Paste" in the popup menu to paste the Set
turnout action.

<p>

<img src="images/chapter1/create_conditionalng_15.png">

<p>

We now have the If Then Else action with the Set turnout action.

<p>

<img src="images/chapter1/create_conditionalng_16.png">

<p>

Right-click (command-click) with the mouse on the If socket and select "Add" in the popup menu to add a new expression.

<p>

<img src="images/chapter1/create_conditionalng_17.png">

<p>

Select the category "Item" and type "Get sensor". Then click on "Create".

<p>

<img src="images/chapter1/create_conditionalng_18.png">

<p>

Create new sensor IS_1_1 and select "Active". Note also the dropdown box "is" / "is not" in the middle. Then click on "Create".

<p>

<img src="images/chapter1/create_conditionalng_19.png">

<p>

We now have a ConditionalNG which will be executed every time the sensor IS_1_1 changes its state. And if IS_1_1 is
changed to "Active", the turnout IT_1_1 will be thrown.

<p>

<hr>


<p>

All actions and expressions in LogixNG are named beans, which means that they have system names and user names. But
it's recommended to only use auto system names and no user names for actions and expressions. Therefore, system names
and user names of actions and expressions are not visible by default. If you want to specify the system names and/or
user names, you can turn on the setting "Show system names and user names" in the LogixNG preferences.
<p>
The most important reason to not use system names and user names for actions and expressions is that it makes it much
easier to copy things. Currently, when a copy is made of actions and/or expressions, the copies get auto names and no
user names. It would be possible to add support for the user to specify system names and/or user names when doing a
copy, but since actions and expressions build a tree, a copy can be of many actions and/or expressions at once.





<h2>1. Basics</h2>

LogixNG has four basic building blocks: Actions, Expressions, Male sockets and Female sockets.

<p>

Actions do something, for example throw a turnout or sets a signal mast. Expressions ask something, for example if a
sensor is active or if a signal head has a particular appearance. The actions and expressions form a tree and a complex
logix can be built with them.

<p>

Each action/expression is embedded in one or several male sockets. Male sockets allow actions/expressions to be
connected to a female socket of the correct type.

<p>

A ConditionalNG has a female socket that is the root of the ConditionalNG tree. And some actions/expressions have one
or several female sockets as children. There are several different female sockets:
<p>
<table border="1" cellspacing="0" cellpadding="2">
<tr><th>Symbol</th><th>Type</th></tr>
<tr><td style="text-align:center">!</td><td>Digital action</td></tr>
<tr><td style="text-align:center">?</td><td>Digital expression</td></tr>
<tr><td style="text-align:center">!b</td><td>Digital boolean action</td></tr>
<tr><td style="text-align:center">!~</td><td>Analog action</td></tr>
<tr><td style="text-align:center">?~</td><td>Analog expression</td></tr>
<tr><td style="text-align:center">!s</td><td>String action</td></tr>
<tr><td style="text-align:center">?s</td><td>String expression</td></tr>
</table>

<h3>Categories</h3>

To get some kind of structure of the types of actions and expressions, LogixNG has a number of categories. Then you
create a new action or expression, you first select the category and then the action/expression. Currently, the
categories are:

<ul>
<li>Item - Actions and expressions related to items on the layout, for example turnouts and signal masts</li>
<li>Common - The most important actions and expressions that are not in the category Item</li>
<li>Other - Other actions and expressions</li>
<li>LocoNet - Actions and expressions related to LocoNet</li>
</ul>

These categories may not be optimal and it would probably be good to have a discussion on the jmri developers mailing
list about these. It's easy to change them, it's easy to add more categories and it's to move an action or expression
from one category to another.

<h3>Create an action: ActionTurnout</h3>

<p>
To add an action or expression, right-click (command-click) with the mouse on a female socket and select <i>Add</i> in
the popup menu. To edit an action or expression, right-click (command-click) with the mouse on that action/expression
and select <i>Edit</i>.
<p>

One thing one notices when creating an action or expression is that LogixNG is much more powerful than Logix. For now,
we only use "Direct" when entering a turnout. We will look at Reference, Local variable and Formula later in this
tutorial.

<h4>Delayed Set Sensor/Turnout</h4>

Logix has the actions <b>Delayed Set Sensor</b>, <b>Reset Delayed Set Sensor</b>, <b>Delayed Set Turnout</b> and
<b>Reset Delayed Set Turnout</b>. LogixNG has instead a generic solution, the action <b>Execute delayed</b>. You add
the action <b>Execute delayed</b>, select the delay and whenever it should reset the timer or not, and then you add
child actions to it, for example a ActionTurnout, ActionSensor or maybe the action Many which in turn can have several
other actions.


<h3>Remove the action and add the action IfThenElse.</h3>
<h3>Add ExpressionSensor and ActionTurnout</h3>

Lets add a new IfThenAction with a ExpressionSensor and a ActionTurnout. To do this, we need to add the action
Many. We can do this by cutting the IfThenElse expression so it's moved to the clip board, then add the Many
action and then paste the IfThenElse action back.


<h3>Cut the IfThenElse action, add a Many action and paste the IfThenElse action.</h3>


<h2>Stop the power during lunch</h2>

Logix support reading the fast clock. LogixNG also supports reading the system clock. Lets assume you want to cut power
to the layout during the lunch. This can easily be done by the following ConditionalNG:

<pre>
* IfThenElse
  * If: And
    * E1: Clock: System clock between 12.00 and 13.00
	* E2: Power: Is power ON?
  * Then: Power: Turn power off
  * Else:
</pre>


</td>
</tr>
</table>
</body>
</html>
