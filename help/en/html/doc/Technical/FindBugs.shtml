<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: FindBugs.shtml,v 1.2 2010-09-07 01:33:17 jacobsen Exp $ -->
<html lang="en">
<head>
    <TITLE>
 	JMRI: Static Analysis with FindBugs
    </TITLE>
    <META content="Bob Jacobsen" name=Author>
    <meta name="keywords" content="JMRI technical code ">

    <!-- The combination of "Define" and {Header,Style, Logo and Footer} comments -->
    <!-- are an arbitrary design pattern used by the update.pl script to -->
    <!-- easily replace the common header/footer code for all the web pages -->

    <!-- delete the following 2 Defines if you want to use the default JMRI logo -->
    <!-- or change them to reflect your alternative logo -->

<!-- Style -->
  <META http-equiv=Content-Type content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css" href="/css/default.css" media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
<!-- /Style -->
</head>

<!--#include virtual="/Header" -->
<!--#include virtual="Sidebar" -->

<div id="mainContent">

<H1>JMRI: Static Analysis with FindBugs</H1>

FindBugs is a tool that can examine code to find possible
problems.  It does a "static analysis", looking through the
code to find certain "known bad ideas":
Things that are likely to cause occasional/intermittent problems,
poor performance, etc.
Because those kinds of problems are hard to find with tests, 
finding them by inspection is often the only realistic approach.  
Having a tool that can do those inspections automatically, 
so that they can be done every time something is changed, 
keeps the code from slowly getting worse and worse without 
anybody noticing until it's too late.
<P>
For more information on FindBugs, see
<A HREF="http://findbugs.sourceforge.net/">the FindBugs home page</A>.

<p>
We routinely run FindBugs as part of our 
<a href="ContinuousIntegration.shtml">continuous integration process</a>.
You can see the results of the most
recent build online
<a href="http://builds.jmri.org/hudson/job/FindBugs/lastBuild/">here</a>.

<p>
If FindBugs is finding a false positive, a bug that's not really a 
bug, you can turn it off with an annotation such as:
<pre><code>
@edu.umd.cs.findbugs.annotations.SuppressWarnings(value="FE_FLOATING_POINT_EQUALITY")
// OK to compare floats, as even tiny differences should trigger update
</code></pre>
Please include a comment that explains why what FindBugs flagged really isn't a bug.

<p>
Simon White added FindBugs support to our Ant-based build
chain during the development of JMRI 2.5.5.
His note on this follows.

<p>
As per feature request 1716873, I've added an ant task to run Findbugs. 
This will produce a report in HTML in the same location as the JMRI jar 
(i.e. the top level project dir). Note the new task first runs ant dist
because FindBugs examines the jmri.jar file.
<p>
To run the task:
<ul>
<li>Install Findbugs (for me I put this in C:/findbugs-1.3.8)
<li>Copy findbugs-ant.jar from the findbugs lib directory to the 
java/lib directory

<li>either run 
 
</code><pre>
ant -Dfindbugs.home=C:/findbugs-1.3.8 findbugs  (replacing the parameter with your install location)
</pre></code>

or edit the build.xml and modified the current commented 
out parameter findbugs.home to your install location and then run

</code><pre>
ant findbugs
</pre></code>
</ul>

On my old machine this takes about 20 minutes but your mileage may vary.
<p>
Note that in the build.xml I have set the maximum memory -Xmx setting for the 
findbugs task to 1024m.
If your system has more memory, boosting this may speed things up.

<p>
Running this on JMRI 2.5.4 produced the following:
<p>
<table border="1">
<tr><td>Bad practice Warnings</td><td>164</td></tr>
<tr><td>Correctness Warnings</td><td>77</td></tr>
<tr><td>Experimental Warnings</td><td>7</td></tr>
<tr><td>Malicious code vulnerability Warnings</td><td>221</td></tr>
<tr><td>Multithreaded correctness Warnings</td><td>90</td></tr>
<tr><td>Performance Warnings</td><td>459</td></tr>
<tr><td>Dodgy Warnings</td><td>304</td></tr>
<tr><th>Total</th><th>1322</th></tr>
</table>

<p>
Note I've only been able to test this on windows 
(my Linux box is much slower and I don't have access to a Mac), 
and the aux classpath I've had to specify for findbugs doesn't include 
the java jars used my the Mac (they broke findbugs on the PC) 
so a seperate solution for Macs might be needed.


<!--#include virtual="/Footer" -->

	  </div><!-- closes #mainContent-->
	</div> <!-- closes #mBody-->
</body>
</html>

