<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<!-- $Id: CircuitBuilder.shtml,v 1.4 2011-05-07 02:21:09 pete_cressman Exp $ -->
<HTML LANG="en">
<HEAD>
<TITLE>JMRI: Item Palette Help</TITLE>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META CONTENT="Pete Cressman" NAME="Author">
<META NAME="keywords" CONTENT="JMRI help Item Palette">

<!-- Style -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="stylesheet" TYPE="text/css" HREF="/css/default.css"
	MEDIA="screen">
<LINK REL="stylesheet" TYPE="text/css" HREF="/css/print.css"
	MEDIA="print">
<LINK REL="icon" HREF="/images/jmri.ico" TYPE="image/png">
<LINK REL="home" TITLE="Home" HREF="/">
<!-- /Style -->
</HEAD>

<BODY>
<!--#include virtual="/Header" -->
  <div class="nomenu" id="mBody">
    <div id="mainContent">

<H1>Circuit Builder</H1>

<b>The Circuit Builder</b> is a view of a <b>Control Panel Editor</b>  
panel used to create track circuits that are implemented in JMRI by 
OBlocks, Portals and OPaths. The
prototype name for track having a device that can detect occupancy is
<b>Track Circuit</b>.  In JMRI we have misused the term <i>"Block"</i> and
<i>"OBlock"</i> to refer to what in the prototype world is a track circuit.
The term <b>Block</b> in the prototype world is <i>a length of track defined
by limits, whose use is governed by block signals, cab signals or block limit 
markers and train orders.</i>
</p>
<p>Circuit Builder is an alternative to using the Occupancy Block Tables.
OBlocks, Portals and OPaths are created and linked by "point and click" to
your layout diagram or panel.  Panel files previously made with Panel Editor
can be used with Circuit Builder as long as they can be loaded into JMRI
version 2.11.5 or later.  Circuit Builder will upgrade the track icons to
Indicator Track icons.  See <A HREF="ItemPalette.shtml"> The Item Palette</A>
for information about indicator track icons.
</p>

 
<H3>Mouse Operations</H3>
Circuit Builder has different mouse click conventions from those of the panel editors.
It does share some operations with them but it is not a tool for creating
panels.  Note the following:
<ul>
<li>Dragging is not permitted. (except in a few specific instances)</li>
<li>Popup menus for any panel item can only be activated in the basic window frame.</li>
<li>Editing is done on the window frames activated under the "Add/Edit Circuits" menu.</li>
<li>When editing, only track icons can be selected.  The selection color is a shade of blue
to diferentiate its selection from the basic editing mode.</li>
</ul> 

<H2>The Menus</H2>
   
<H3>The File Menu</H3>
The only menu item returns the view to the Control Panel Editor</P>

<H3>The Options Menu</H3>

<H3>The Add/Edit Circuits Menu</H3>
Create and Edit OBlocks, Portals and OPaths and their display icons.
<ul>
 <li>Add New Circuit - Create an OBlock track circuit and assign the icons that represent it.</li>
 <li>Edit Circuit - Has a submenu for each defined track circuit (OBlock) to modify the OBlock
 or its icons.</li>
 <li>Add/Edit Portal -  Create or edit Portals connecting two track circuits.</li>
 <li>Add/Edit Path - Create or edit the paths (OPath) through a track circuit.</li>
</ul>

<H3>The Error Check Menu</H3>
Verify OBlocks, Portals and OPaths are complete and without errors.
<ul>
 <li>Circuits without icons - Has a submenu for each track circuit OBlock that does not have an icon.</li>
 <li>Circuit icons need conversion - Has a submenu for each track circuit OBlock whose track icons
 are not Indicator Track icons.</li>
 <li>Highlight track icons needing conversion - Highlight all track icons that are not 
 Indicator Track icons.</li>
 <li>Highlight track icons without circuits - Highlight all track icons that are not 
 associated with a track circuit.</li>
 <li>Check Portal and Path errors - Examines the Portal and OPath definitions looking
 for errors or incomplete information.</li>
</ul>

<H2>How to Make OBlocks, Portals and OPaths</H2>
<H3>OBlocks</H3>
<ul>
 1. From the <b>Add/Edit Circuits</b> menu select the <b>Add Circuit</b> menu item.
 This opens a dialog for you to give the circuit OBlock its system and user names.  Creating
 the OBlock opens the <b>Add Detector Circuit</b> window.
<p>
2. The Add Detector Circuit window has text fields to name the sensor that will detect
occupancy and a sensor that can detect power problems.  Each of these sensors are optional
and can be entered later.  If no occupancy detection sensor is named the circuit will 
be a Dark Block.
<p>
 3. The Add Detector Circuit window also has convenience fields that count the track icons
 that are selected for the circuit.  
<p>
 4. In the main window select icons that comprise the circuit (i.e. OBlock).  A mouse click
 on an icon selects it and a second click will deselect it. 
 The icons are highlighted in blue.   
 5. The <b>Convert Icons</b> button will convert the icons in the circuit to Track Indicator
 icons if they are not already icons of this type.  This can be done later.
<p>
 6. The <b>Done</b> button completes the creation of the track circuit and adds it as a
 subitem to the menu itens in the Add/Edit Circuits menu. You can return to
 the <b>Add Detector Circuit</b> window for this track circuit later by choosing the block's
 sub item in the <b>Edit Circuit</b> menu item.
<p>
</ul>
  
<H3>Portals</H3>
<ul>
 1. From the <b>Add/Edit Circuits</b> menu select a track circuit subitem from the
 <b>Edit Portal</b> menu item.  The track circuit will be highlighted in blue and you will 
 be prompted to select an adjacent block so the portal can have its required connections.
 Selecting a second track circuit opens the <b>Edit Portal</b> window.  The second
 connecting circuit is highlighted in a lighter shade of blue. 
<p> 
 2. The Edit Portal window has a list of the the portals already defined for the
 track circuit (OBlock) and a text field to name portals to be created. The window
 also has a icon to represent portals as a red circle in the main window.
<p>  
 3. Portals are created by naming them and dragging the red
 circle icon to its position between the two track circuits it connects.  After dragging the
 icon into position the portal is listed in the Portal List. 
<p>
 4. Portals that were created in the <b>Occupancy Tables</b> do not have red circle icons.
 For any portal in the Portal List that does not have an icon, select it from the list and
 drag a red circle icon to its position between the blocks it connects.  
 Portal icons are needed to create and display paths.  <i>Please be sure all portals are 
 represented by icons before making paths.</i>
 <p>
 5. To change the name of a portal, first select it from the list, then change the name in the
 <b>Portal Name</b> text field and lastly, press the <b>Change Name</b> button.
 <p>
 6. To delete a portal, select it from the list and press the <b>Delete Portal</b> button.
</ul> 

<H3>Paths</H3>
<ul>
 1. From the <b>Add/Edit Circuits</b> menu select a block subitem from the 
 <b>Edit Paths</b> menu item.  
<p>
 2. The Edit Paths window has a list of the the paths already defined for the track circuit
  and a text field to name patjs to be created.
<p>
 3. Paths are created by selecting the icons that display the path. The selected icons are
 displayed green.  A second mouse click deselects the icon.
<p>
 4. When selecting a turnout icon for the path, it needs its point set correctly.  To keep
 the icon selected gren when you throw the switch, hold the Shift Key down when clicking 
 with the mouse.  
<p>
 5. To change the name of a path, first select it from the list, then change the name in the
 <b>Path Name</b> text field and lastly, press the <b>Change Name</b> button.
<p>
 6. To delete a path, select it from the list and press the <b>Delete Path</b> button.
</ul> 
<!--#include virtual="/Footer" -->
</BODY>
</HTML>
