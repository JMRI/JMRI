package jmri.util.swing.multipane;

import java.awt.GraphicsEnvironment;
import javax.swing.JButton;
import javax.swing.JFrame;
import jmri.util.JUnitUtil;
import jmri.util.swing.SamplePane;
import junit.extensions.jfcunit.TestHelper;
import junit.extensions.jfcunit.eventdata.MouseEventData;
import junit.extensions.jfcunit.finder.AbstractButtonFinder;
import junit.framework.Test;
import junit.framework.TestSuite;
import org.junit.Assert;

/**
 * Swing jfcUnit tests for the Multipane (IDE) GUI
 *
 * @author	Bob Jacobsen Copyright 2010
 */
public class MultiJfcUnitTest extends jmri.util.SwingTestCase {

    public void testShow() throws Exception {
        if (GraphicsEnvironment.isHeadless()) {
            return; // Can't assume in TestCase
        }
        // show the window
        JFrame f1 = new MultiPaneWindow("test",
                "java/test/jmri/util/swing/xml/Gui3LeftTree.xml",
                "java/test/jmri/util/swing/xml/Gui3Menus.xml",
                "java/test/jmri/util/swing/xml/Gui3MainToolBar.xml"
        );
        f1.setSize(new java.awt.Dimension(500, 500));
        f1.setVisible(true);

        Assert.assertNotNull("found main frame", f1);

        // Find the button that loads the license
        AbstractButtonFinder finder = new AbstractButtonFinder("License");
        JButton button = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("License button found", button);

        // Click it to load license
        getHelper().enterClickAndLeave(new MouseEventData(this, button));

        // Find the button that opens a sample panel
        AbstractButtonFinder samplefinder = new AbstractButtonFinder("Sample");
        JButton samplebutton = (JButton) samplefinder.find(f1, 0);
        Assert.assertNotNull("Sample button found", samplebutton);

        // Click it to load new pane over license
        getHelper().enterClickAndLeave(new MouseEventData(this, samplebutton));

        // Find the button on new panel
        finder = new AbstractButtonFinder("Next1");
        JButton next1button = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("Next1 button found", next1button);

        // Click it to load new window with Next2
        getHelper().enterClickAndLeave(new MouseEventData(this, next1button));

        // nobody disposed yet
        Assert.assertEquals("no panes disposed", 0, SamplePane.disposed.size());

        // Find the Next2 button on new panel
        finder = new AbstractButtonFinder("Next2");
        JButton next2button = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("Next2 button found", next2button);

        // Click sample to reload 0 pane over 1 pane
        getHelper().enterClickAndLeave(new MouseEventData(this, samplebutton));

        // Find the button on restored panel
        finder = new AbstractButtonFinder("Next1");
        button = (JButton) finder.find(f1, 0);
        Assert.assertEquals("found same pane", next1button, button);

        // Find the button to open a pane in lower window
        finder = new AbstractButtonFinder("Extend1");
        JButton extendButton = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("Extend1 button found", extendButton);
        // Press it
        getHelper().enterClickAndLeave(new MouseEventData(this, extendButton));

        // Both Close1 and Close3 should be present
        finder = new AbstractButtonFinder("Close1");
        button = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("Closee1 button found", button);
        finder = new AbstractButtonFinder("Close3");
        button = (JButton) finder.find(f1, 0);
        Assert.assertNotNull("Close3 button found", button);

        // nobody disposed yet
        Assert.assertEquals("no panes disposed", 0, SamplePane.disposed.size());

        // Close entire frame directly
        TestHelper.disposeWindow(f1, this);

        // Now they're disposed
        Assert.assertEquals("panes disposed", 3, SamplePane.disposed.size());

    }

    // from here down is testing infrastructure
    public MultiJfcUnitTest(String s) {
        super(s);
    }

    // Main entry point
    static public void main(String[] args) {
        String[] testCaseName = {MultiJfcUnitTest.class.getName()};
        junit.textui.TestRunner.main(testCaseName);
    }

    // test suite from all defined tests
    public static Test suite() {
        TestSuite suite = new TestSuite(MultiJfcUnitTest.class);
        return suite;
    }

    // The minimal setup for log4J
    @Override
    protected void setUp() throws Exception {
        super.setUp();
        JUnitUtil.setUp();
        //jmri.util.JUnitUtil.initInternalTurnoutManager();
        //jmri.util.JUnitUtil.initInternalSensorManager();
        jmri.util.swing.SamplePane.disposed = new java.util.ArrayList<>();
        jmri.util.swing.SamplePane.index = 0;
    }

    @Override
    protected void tearDown() throws Exception {
        JUnitUtil.tearDown();
        super.tearDown();
    }
}
